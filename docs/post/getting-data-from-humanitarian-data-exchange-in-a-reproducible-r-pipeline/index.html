<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Getting data from Humanitarian Data Exchange in a reproducible R pipeline | CallumGWTaylor</title>
  <link rel = 'canonical' href = 'https://callumgwtaylor.github.io/post/getting-data-from-humanitarian-data-exchange-in-a-reproducible-r-pipeline/'>
  <meta name="description" content="ü©∫ : Intensive Care Trainee in West of Scotland üéì: Currently Studying for MA Medical Ethics and Law @ Keele Uni">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Getting data from Humanitarian Data Exchange in a reproducible R pipeline" />
<meta property="og:description" content="Update: I‚Äôve updated a couple of these functions, as they were messy and unreliable (they probably still are!). I‚Äôve also put them together as a mini-package that you can install from github: hdxr. The code below is the OLD version, the up to date versions are on github. If you‚Äôve ideas on how I should do it better, please let me know on github/twitter.
I‚Äôve been trying to make it easier for me to get information from the Humanitarian Data Exchange." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://callumgwtaylor.github.io/post/getting-data-from-humanitarian-data-exchange-in-a-reproducible-r-pipeline/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-06-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-06-04T00:00:00+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Getting data from Humanitarian Data Exchange in a reproducible R pipeline"/>
<meta name="twitter:description" content="Update: I‚Äôve updated a couple of these functions, as they were messy and unreliable (they probably still are!). I‚Äôve also put them together as a mini-package that you can install from github: hdxr. The code below is the OLD version, the up to date versions are on github. If you‚Äôve ideas on how I should do it better, please let me know on github/twitter.
I‚Äôve been trying to make it easier for me to get information from the Humanitarian Data Exchange."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://callumgwtaylor.github.io/css/styles.3d6ddd2e2b67af29c77aa7b2635bce5cecbdc1c2ad8f72901ab637c34a120389677a2444bb4c93601aa17e927db9e362cd7f63aafa475d34f8288856b16ccb47.css" integrity="sha512-PW3dLitnrynHeqeyY1vOXOy9wcKtj3KQGrY3w0oSA4lneiREu0yTYBqhfpJ9ueNizX9jqvpHXTT4KIhWsWzLRw=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://callumgwtaylor.github.io/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://callumgwtaylor.github.io/">
  
    <div id="logo" style="background-image: url(https://callumgwtaylor.github.io/images/logo.png)"></div>
  
  <div id="title">
    <h1>CallumGWTaylor</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="Menu"><i class="fas fa-bars fa-2x" aria-hidden="true"></i></a>
      </li>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/post">All posts</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
        <li><a href="/index.xml">RSS</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    


<p><strong>Update</strong>: I‚Äôve updated a couple of these functions, as they were messy and unreliable (they probably still are!). I‚Äôve also put them together as a mini-package that you can install from github: <a href="https://github.com/callumgwtaylor/hdxr">hdxr</a>. The code below is the OLD version, the up to date versions are on github. If you‚Äôve ideas on how I should do it better, please let me know on github/twitter.</p>
<p>I‚Äôve been trying to make it easier for me to get information from the <a href="https://data.humdata.org/">Humanitarian Data Exchange</a>. The folk who run the centre have been trying to make it easier to access too, they‚Äôve released a <a href="https://github.com/OCHA-DAP/hdx-python-api">python api</a>, and they use CKAN so you can download JSON information about each ‚Äòpackage‚Äô (basically the subject of the data) and each ‚Äòresource‚Äô (the data itself). The problem for me is I don‚Äôt know python, I‚Äôm not comfortable with CKAN, and struggle with JSON also.</p>
<p>All I wanted to be able to do was search for a package, and download a specific resourse, in a reproducible and roughly tidy-ish fashion</p>
<p>I‚Äôve made a couple of functions to make it easier to do so. I‚Äôve been using <code>ckanr</code> and <code>jsonlite</code></p>
<p>So here are the functions I‚Äôve made, and an example of using them:</p>
<div id="functions-for-interacting-with-the-hdx-ckan" class="section level2">
<h2>Functions for interacting with the HDX CKAN</h2>
<pre class="r"><code>library(ckanr)
library(tidyverse)
library(jsonlite)</code></pre>
<div id="hdx_connect" class="section level3">
<h3>hdx_connect()</h3>
<p>This will use the <code>ckanr</code> package to connect to the HDX ckan server.</p>
<pre class="r"><code># This creates a function to connect to the hdx server
hdx_connect &lt;- function(){
ckanr_setup(url = &quot;http://data.humdata.org/&quot;)
}</code></pre>
</div>
<div id="hdx_list" class="section level3">
<h3>hdx_list()</h3>
<p>This function takes one argument, limit. It will return a list of HDX packages, depending on the limit set. There‚Äôs currently almost 5000 packages.</p>
<pre class="r"><code># This function will create a data frame of the length set in x, listing the packages in x
hdx_list &lt;- function(limit){
package_list(as = &#39;table&#39;, limit = limit) %&gt;%
as_data_frame(.)
}</code></pre>
</div>
<div id="hdx_package_search" class="section level3">
<h3>hdx_package_search()</h3>
<p>So after seeing roughly which package you want to look at, either through the package list, or browsing on the website, you would search for it through this function.</p>
<p>This will return a dataframe, with some nested lists, and nested dataframes. It‚Äôs reasonably easy to browse to then work out exactly which package you want.</p>
<pre class="r"><code>hdx_package_search &lt;- function(term){
package_search(q = term, as = &quot;json&quot;) %&gt;%
    jsonlite::fromJSON(., flatten = TRUE) %&gt;%
    .$result %&gt;%
    .$results 
}</code></pre>
</div>
<div id="hdx_resource_list" class="section level3">
<h3>hdx_resource_list()</h3>
<p>To see the exact resources available in an easier-to-read dataframe they need unnesting. When this function is used on the results of <code>hdx_package_search()</code>, it will extract a resources dataframe, then left join the results onto the original dataframe provided to it.</p>
<pre class="r"><code># This function will take the results of a package_search and extract the resources, it will then link those resources to the results from package search giving a new data frame
hdx_resource_list &lt;- function(package){
package$resources %&gt;%
    as.data.frame(.) %&gt;%
    left_join(package, ., by = c(&quot;id&quot; = &quot;package_id&quot;)) %&gt;%
    select(-resources)
}</code></pre>
</div>
</div>
<div id="getting-data-off-of-hdx" class="section level2">
<h2>Getting data off of HDX</h2>
<p>Once you‚Äôve used all the functions, you should have a dataframe with titles for the packages, and urls for the resources. You can then use <code>httr</code> or <code>readr</code> to download the files and bring them into your work.</p>
<div id="example-exploring-the-acled-conflict-data-for-africa" class="section level3">
<h3>Example: Exploring the ACLED Conflict Data for Africa</h3>
<p>In this example I am going to identify the package ‚ÄúACLED Conflict Data for Africa (Realtime - 2017)‚Äù <a href="https://data.humdata.org/dataset/acled-conflict-data-for-africa-realtime-2017"><em>here</em></a>. It has an excel file, and a zipped csv. I‚Äôll then identify the resource for the unzipped excel file.</p>
<p>Once we have that, we can use <code>httr</code> to download the file, and <code>readxl</code>to load it in.</p>
<pre class="r"><code>library(ckanr)
library(tidyverse)
library(jsonlite)
library(readxl)
library(httr)</code></pre>
<pre class="r"><code># First we connect to HDX

hdx_connect()

# We can list all packages available for us

hdx_list(5000)</code></pre>
<pre><code>## # A tibble: 4,905 x 1
##                                                                          value
##                                                                          &lt;chr&gt;
##  1                                       141121-sierra-leone-health-facilities
##  2                                      160516-ecuador-earthquake-4w-1st-round
##  3                                                      160523-ocha-4w-round-2
##  4                                                     160625-hrrp-4w-national
##  5 1999-2013-tally-of-internaly-displaced-persons-resulting-from-natural-disas
##  6                                                                  2011-nepal
##  7                                       2012-census-tanzania-wards-shapefiles
##  8                                        2014-2015-food-security-ipc-analysis
##  9                         2014-nutrition-smart-survey-results-and-2015-trends
## 10                                 2015-humanitarian-needs-overview-indicators
## # ... with 4,895 more rows</code></pre>
<pre class="r"><code># We then search for the package we want, and use dplyr to filter it to the exact package

hum_data_packages &lt;- hdx_package_search(&quot;ACLED Conflict Data for Africa&quot;) %&gt;%
  filter(title == &quot;ACLED Conflict Data for Africa (Realtime - 2017)&quot;)

# We then expand our resources from the search result, and look for the unzipped excel file

hum_data_resources &lt;- hdx_resource_list(hum_data_packages) %&gt;%
  filter(format == &quot;XLSX&quot;)</code></pre>
<pre class="r"><code>url &lt;- hum_data_resources$hdx_rel_url
GET(url, write_disk(&quot;dataset.xlsx&quot;, overwrite=TRUE))</code></pre>
<pre><code>## Response [http://www.acleddata.com/wp-content/uploads/2017/06/ACLED-All-Africa-File_20170101-to-20170617.xlsx]
##   Date: 2017-07-03 12:21
##   Status: 200
##   Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
##   Size: 1.86 MB
## &lt;ON DISK&gt;  C:\Users\callu\Dropbox\blog\content\post\dataset.xlsx</code></pre>
<pre class="r"><code>ACLED_CONFLICT_DATA &lt;- read_excel(&quot;dataset.xlsx&quot;, col_names = TRUE)
rm(url)</code></pre>
</div>
</div>

  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  CallumGWTaylor 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/post">All posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/index.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
